(()=>{"use strict";function t(t){if(t<1)return 0;var e=Math.floor(Math.log(t)/Math.log(1024));return 1*(t/Math.pow(1024,e)).toFixed(2)+" "+["Byte","KB","MB","GB","TB"][e]}var e,o,n;e=jQuery,o=window.ModuleBuilderModal,n={init:function(){e(document).on("click",".igd-tutor-button",n.handleVideoSelector),e(document).on("click",".video_source_wrap_google_drive .tutor-igd-delete-video",n.removeVideo),e(window).on("tutor_modal_shown",(function(){e(".tutorIgdUploadAttachmentBtn").length||e(".tutorUploadAttachmentBtn").after('<button type="button" class="tutor-btn tutor-btn-outline-primary tutorIgdUploadAttachmentBtn"><span class="tutor-icon-brand-google-drive tutor-mr-8"></span><span>'.concat(wp.i18n.__("Add Attachments","tutor"),"</span></button>")),n.initAttachments()})),e(document).on("click",".tutorIgdUploadAttachmentBtn",n.handleAttachmentSelection),e(document).on("click",".tutor-igd-delete-attachment",n.deleteAttachment),e(".tutor-dashboard-setting-google-drive .remove-account").on("click",n.removeAccount)},removeAccount:function(){var t=this;Swal.fire({title:wp.i18n.__("Are you sure?","integrate-google-drive"),text:wp.i18n.__("You won't be able to revert this!","integrate-google-drive"),icon:"warning",showCancelButton:!0,confirmButtonText:wp.i18n.__("Yes, remove it!","integrate-google-drive"),reverseButtons:!0,showLoaderOnConfirm:!0,customClass:{container:"igd-swal"},preConfirm:function(){var o=e(t).closest(".igd-account-item").data("id");return wp.ajax.post("igd_delete_account",{id:o})}}).then((function(o){o.value&&(e(t).closest(".igd-account-item").remove(),Swal.fire({title:wp.i18n.__("Removed!","integrate-google-drive"),text:wp.i18n.__("Account has been removed.","integrate-google-drive"),icon:"success",showConfirmButton:!1,timer:1500,toast:!0}))}))},handleVideoSelector:function(t){t.preventDefault();var a=e(this);Swal.fire({html:'<div id="igd-select-files" class="igd-module-builder-modal-wrap"></div>',showConfirmButton:!1,customClass:{container:"igd-module-builder-modal-container"},didOpen:function(t){ReactDOM.render(React.createElement(o,{initData:{},onUpdate:function(t){Swal.close(),n.addVideo(a,t[0])},onClose:function(){return Swal.close()},isLMS:"tutor"}),document.getElementById("igd-select-files"))},willClose:function(t){ReactDOM.unmountComponentAtNode(document.getElementById("igd-select-files"))}})},addVideo:function(o,n){var a=n.id,i=n.accountId,d=n.name,r=n.size,c=n.metaData,u=o.closest(".video_source_wrap_google_drive");u.addClass("tutor-has-video");var l="".concat(igd.ajaxUrl,"?action=igd_stream&id=").concat(a,"&accountId=").concat(i);if(e('input[name="video[source_google_drive]"]',u).val(l),e('input[name="video[name_google_drive]"]',u).val(d),e('input[name="video[size_google_drive]"]',u).val(r),c&&c.duration){var s=c.duration/1e3,m=Math.floor(s/3600),v=Math.floor(s%3600/60),g=Math.floor(s%60),h=u.closest(".tutor_lesson_modal_form").find(".tutor-option-field-video-duration"),p=e('input[name="video[runtime][hours]"]',h);m>0&&p.val(String(m).padStart(2,"0"));var f=e('input[name="video[runtime][minutes]"]',h);v>0&&f.val(String(v).padStart(2,"0"));var _=e('input[name="video[runtime][seconds]"]',h);g>0&&_.val(String(g).padStart(2,"0"))}e(".video-data-title",u).text(d),e(".video-data-size",u).text(t(r))},removeVideo:function(t){t.preventDefault();var o=e(this).closest(".video_source_wrap_google_drive");o.removeClass("tutor-has-video"),e('input[name="video[source_google_drive]"]',o).val(""),e('input[name="video[name_google_drive]"]',o).val(""),e('input[name="video[size_google_drive]"]',o).val(""),e(".video-data-title",o).text(""),e(".video-data-size",o).text("")},handleAttachmentSelection:function(t){t.preventDefault();var a=e(this);Swal.fire({html:'<div id="igd-select-files" class="igd-module-builder-modal-wrap igd-tutor-attachment-modal"></div>',showConfirmButton:!1,customClass:{container:"igd-module-builder-modal-container"},didOpen:function(t){ReactDOM.render(React.createElement(o,{initData:{},onUpdate:function(t){Swal.close();var e=t.folders,o=(void 0===e?[]:e).map((function(t){return{id:t.id,accountId:t.accountId,name:t.name,size:t.size}})),i=a.closest(".tutor_lesson_modal_form");n.addAttachment(i,o)},onClose:function(){return Swal.close()},isSelectFiles:!0}),document.getElementById("igd-select-files"))},willClose:function(t){ReactDOM.unmountComponentAtNode(document.getElementById("igd-select-files"))}})},initAttachments:function(){var t=e(".tutor_lesson_modal_form"),o=t.find('input[type="hidden"][name^="igd_tutor_attachments"]'),a=[];o.each((function(){var t=e(this),o=t.attr("name").match(/^igd_tutor_attachments\[(.+?)\]\[(.+?)\]$/);if(o){var n=o[1],i=o[2],d=a.find((function(t){return t.id===n}));d||(d={id:n},a.push(d)),d[i]=t.val()}})),a.length&&n.addAttachment(t,a,!1)},addAttachment:function(o,n){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i='<div class="tutor-col-lg-6 tutor-col-xl-4 tutor-mb-16 igd-tutor-attachment" data-id="">\n    <div class="tutor-card">\n     <div class="tutor-card-body">\n      <div class="tutor-row tutor-align-center">\n       <div class="tutor-col tutor-overflow-hidden">\n       <i class="tutor-icon-brand-google-drive tutor-color-primary"></i>\n        <div class="tutor-fs-6 tutor-fw-medium tutor-color-black tutor-text-ellipsis tutor-mb-4 attachment-name"></div>\n        <div class="tutor-fs-7 tutor-color-muted">'.concat(wp.i18n.__("Size:","integrate-google-drive"),'  <span class="attachment-size"></span></div>\n       </div>\n\n       <div class="tutor-col-auto">\n        <span class="tutor-igd-delete-attachment tutor-iconic-btn tutor-iconic-btn-secondary" role="button">\n         <span class="tutor-icon-times" aria-hidden="true"></span>\n        </span>\n       </div>\n      </div>\n     </div>\n    </div>\n   </div>'),d=o.find(".tutor-attachment-cards");n.forEach((function(n){var r=n.id,c=n.accountId,u=n.name,l=n.size,s=e(i);if(s.attr("data-id",r),s.find(".attachment-name").text(u),s.find(".attachment-size").text(t(n.size)),d.append(s),a){var m=e('<input type="hidden" name="igd_tutor_attachments['.concat(r,'][id]" value="').concat(r,'">')),v=e('<input type="hidden" name="igd_tutor_attachments['.concat(r,'][accountId]" value="').concat(c,'">')),g=e('<input type="hidden" name="igd_tutor_attachments['.concat(r,'][name]" value="').concat(u,'">')),h=e('<input type="hidden" name="igd_tutor_attachments['.concat(r,'][size]" value="').concat(l,'">'));o.append(m,v,g,h)}}))},deleteAttachment:function(t){t.preventDefault();var o=e(this).closest(".tutor-col-lg-6"),n=o.data("id"),a=o.closest(".tutor_lesson_modal_form");a.find('input[name="igd_tutor_attachments['.concat(n,'][id]"]')).remove(),a.find('input[name="igd_tutor_attachments['.concat(n,'][accountId]"]')).remove(),a.find('input[name="igd_tutor_attachments['.concat(n,'][name]"]')).remove(),a.find('input[name="igd_tutor_attachments['.concat(n,'][size]"]')).remove(),o.remove()}},e(document).ready(n.init)})();